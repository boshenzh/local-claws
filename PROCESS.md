# Process Log

## 2026-02-22
- Revised `content/skills/heartbeat.md` into a systematic runtime manual: added role capability matrix, explicit SSE/backlog event contract, ack-state mapping, cursor safety rules, host polling cadence, failure recovery matrix, and operator-level health checklist.
- Rewrote `content/skills/skill.md` into a systematic operator manual (contract-first sections: invariants, prerequisites, role gating, delivery/event schemas, deterministic attendee/host runbooks, explicit error/retry matrix, and health checklist) and bumped canonical skill version to `1.2.0-beta.0`.
- Removed legacy role-specific prompt markdown endpoints and source files (`/.well-known/localclaws-host-skill.md`, `/.well-known/localclaws-attendee-skill.md`); LocalClaws now uses only canonical skill bundle files (`/skill.md`, `/heartbeat.md`, `/messaging.md`, `/rules.md`, `/skill.json`).
- Expanded LocalClaws skill docs to a Moltbook-style comprehensive operator manual: upgraded `content/skills/skill.md`, `heartbeat.md`, `messaging.md`, `rules.md`, and `skill.json` with explicit setup prerequisites, request/response examples, event model, retry policy, troubleshooting, and security guardrails.
- Expanded the OpenClaw package docs under `skills/localclaws/` to match the comprehensive manual level (role workflows, runtime templates, safety and endpoint references) for ClawHub-ready publishing quality.
- Added canonical Moltbook-style skill bundle routes (`/skill.md`, `/heartbeat.md`, `/messaging.md`, `/rules.md`, `/skill.json`) with fallback-backed serving from `content/skills/*`, while keeping legacy role URLs under `/.well-known/*` as compatibility entrypoints pointing to the canonical bundle.
- Added an OpenClaw/ClawHub-ready installable skill package at `skills/localclaws/` (`SKILL.md`, role workflow references, safety/API references, and heartbeat/messaging templates) so LocalClaws can be distributed natively to OpenClaw agents in addition to URL-based onboarding.
- Added a rolling “Recent LocalClaws event boards” strip under attendee setup on the landing page, showcasing recent public offline meetup cards with direct links to event details.
- Added a new landing-page footer with retro styling, quick navigation links (Home/Event Board/Host/Attend), privacy link, and a trust-oriented privacy note.
- Hardened SEO/geo baseline for public pages: added per-route metadata (home/board/event/host/attend), JSON-LD (WebSite/Organization/CollectionPage/ItemList/Event), `robots.txt` + `sitemap.xml` routes, and explicit `noindex,nofollow` for invite/letter token pages; fixed metadata typing for geo tags and stabilized canonical base URL resolution for Vercel production.
- Upgraded unlocked invitation letter UX with a fun “party pack”: added one-click `Save to Calendar (.ics)` export, exact-location minimap embed (lat/lon-first fallback), and `Save as Image (PNG)` capture for a collectible invite card, while keeping all features passcode-gated.
- Added a dev-only letter index page at `/dev/letters` to list active invitation tokens and open `/letter/:token` directly during local testing (hidden in production).
- Added the new crab logo across core UI surfaces (home, event board, event detail, invite, host, attend) via reusable `LogoMark` component and shipped `public/localclaws-logo.png` as shared brand asset/fav icon.
- Fixed direct-open handling for `/letter/:token/verify`: added `GET` redirect back to `/letter/:token` to avoid Next.js dev/runtime bootstrap invariant on unsupported-method navigation to the verify endpoint.
- Enforced map-link private venue workflow for meetup creation: `POST /api/meetups` now requires `private_location_link` (any valid map provider URL), parses provider/label/coordinates/parse-status metadata, and keeps exact venue reveal restricted to invitation-letter passcode verification.
- Expanded private-location parsing beyond fixed providers: added generic coordinate/label extraction for arbitrary map URLs (including OSM hash and Bing cp-style formats), exposed provider host metadata, and wired event detail map center to a radius-snapped public coordinate derived from parsed link data.
- Added runnable location parser matrix tests (`npm run test:location-links`) covering Google/Apple/Amap plus Bing/OSM/Kakao/generic URL formats.
- Migrated persistence baseline to Postgres when `DATABASE_URL` is present: added `lib/postgres.ts`, persisted full app state snapshot in `localclaws_state`, moved waitlist entries to `localclaws_waitlist`, moved ops metrics to `localclaws_metrics`, and wired API/SSR handlers to hydrate (`ensureStoreReady`) before reads and persist (`persistStore`) after mutations; in-memory fallback remains for local/dev without DB.
- Added minimal `pages/_app.tsx` and `pages/_document.tsx` to prevent fallback runtime crashes when Next.js tries to load `.next/server/pages/_document.js` during dev error rendering.
- Prepared Vercel deployment baseline: added `vercel.json`, tracked `.env.example` template, and documented Vercel setup steps plus in-memory persistence caveat in README.
- Added attendee request-join workflow with host approval gate: new APIs for `POST /api/meetups/:id/join-requests`, host review/decision (`GET /api/meetups/:id/join-requests`, `POST /api/join-requests/:requestId/decision`), per-host ClawDBot Telegram routing (`GET/POST /api/hosts/alerts`), and join-request notification events on stream/backlog.
- Added public meetup radius support (`public_radius_km`, default 5km) and updated event detail page to show exact start time plus radius-based rough location context/map zoom while keeping exact venue private behind invitation letters.
- Aligned attendee skill ACK guidance with actual API contract: `POST /api/events/:eventId/ack` now documented with valid statuses only (`received`, `notified_human`, `actioned`) and clarified that `actioned` covers both confirmed and declined human outcomes.
- Fixed three event-board/home UI bugs: wired homepage email list form to `POST /api/waitlist` with visible success/error feedback, preserved board filters/view on event detail "Back to board", and corrected board view-toggle accessibility markup by using link navigation semantics instead of incomplete tab ARIA roles.
- Hardened invite dispatch safety and ID stability: `POST /api/meetups/:id/invite` now rejects non-`open` meetups, and subscription/event/delivery/attendee IDs now use persisted global singleton counters to prevent HMR/reload duplicates.
- Reworked both public skill docs (`/.well-known/localclaws-host-skill.md`, `/.well-known/localclaws-attendee-skill.md`) into a prompt-first format inspired by Moltbook-style onboarding: explicit copy/paste command, mission, success criteria, step-by-step agent actions, and strict privacy rules.
- Added formal spec package for Moltbook identity claim workflow (`specs/moltbook-identity-claim-v1` with requirements/design/tasks) based on developer verification flow.
- Refactored global UI styling into a 16-bit arcade bulletin-board direction across home, board, host/attendee, invite, and letter surfaces (pixel-border cards, constrained retro palette, textured backgrounds, chip/button treatment, and step-based motion).
- Rebalanced the retro theme for legibility after first pass: restored readable body typography hierarchy, reduced aggressive uppercase/tracking, and increased control text sizes while preserving the gaming visual language.
- Shifted invitation control to host agents: meetup creation now returns suggested attendee candidates, and hosts explicitly trigger distribution via `GET /api/meetups/:id/candidates` plus `POST /api/meetups/:id/invite`.
- Added cold-start expansion flags for host-controlled invites: `GET /api/meetups/:id/candidates?include_unsubscribed=true` and `POST /api/meetups/:id/invite` with `allow_unsubscribed=true`.
- Added host-configured Moltbook candidate support: sync profiles via `POST /api/integrations/moltbook/profiles`, query via `include_moltbook=true`, and execute returned `external_invite_tasks` from invite responses.
- Fixed in-memory store consistency across Next.js route bundles by moving `lib/store.ts` state to a `globalThis` singleton (`db` + ID counter + seeding guard), unblocking cross-route invite flows (create meetup -> personalized invite confirm).
- Redesigned the homepage UX to a Moltbook-inspired, retro game style with consistent themed sections.
- Replaced home navigation with `For Host`, location-aware `Event Board`, and disabled `Login (Coming soon)`.
- Added new hero messaging and slogan: "Find your local claws through your agent."
- Added dual tutorial cards for participants and hosts, each with role-specific `.well-known` skill instructions.
- Added trust/privacy explainer strip to reinforce public-vs-private detail boundaries.
- Added bottom email-list signup section UI and documented planned waitlist API contract (`POST /api/waitlist`) in-page copy.
- Kept host/attendee/calendar route compatibility intact while scoping redesign to homepage.
- Reworked routing so `/calendar` is now the main Event Board entry with city picker and a `Cards | Month calendar` toggle.
- Added card-first Event Board browsing with public meetup cards and detail CTA per event.
- Added dedicated event detail route at `/calendar/[city]/event/[meetupId]` with district-level map context and privacy-safe public info only.
- Converted `/calendar/[city]` into a compatibility redirect to `/calendar?city=...&view=month`.
- Simplified homepage information flow to essential sections: focused hero, compact setup tutorials, and waitlist.
- Replaced dual tutorial cards on homepage with a single click-toggle tutorial module (`For Event Participants` / `For Event Hosts`) for cleaner information flow.
- Removed the homepage `Host a Meetup` hero button, keeping Event Board as the primary hero action.
- Removed the `/host` page route and repointed all `For Host` / `Host entrance` links to the host skill doc (`/.well-known/localclaws-host-skill.md`).
- Removed the participant/host tutorial toggle from homepage, kept participant onboarding only, and changed navbar `For Host` to `Become a Host` linking to a dedicated host setup section with Moltbook integration steps.
- Added a dedicated `/host` guide page for `Become a Host` with detailed onboarding, copy-paste prompt, LocalClaws host API sequence, and optional Moltbook extension workflow.
- Added waitlist consent gating on homepage: users must check “I agree to receive email updates and accept the Privacy Policy” before join, with a new `/privacy` page and server-side consent validation in `/api/waitlist`.
- Hardened `.well-known` skill endpoints against deployment file-tracing misses: added output tracing include for `content/skills/*.md` and embedded fallback markdown so host/attendee skill URLs return content instead of HTTP 500 if disk reads fail.
- Upgraded Event Board city picker from dropdown to searchable autofill input (major-city suggestions + city name normalization), and added empty-city CTA to `/host` so users can become a host and create the first meetup when no events exist.
- Added true typeahead autocomplete UI for Event Board city search plus card-level temporal status chips (`Past` / `Future`) so attendees can scan meetup recency at a glance.
- Replaced machine-style board timestamps with human-readable local phrases (e.g. `Today, 6:30 PM`, `Tomorrow, 7:00 PM`, `Monday, 6:00 PM`) across Event Board cards, agenda list, and event detail hero/public fields.

## 2026-02-17
- Implemented LocalClaws v1 scaffold with Next.js App Router.
- Added role entrances: `/host` and `/attend`.
- Added role skill docs at `/.well-known/localclaws-host-skill.md` and `/.well-known/localclaws-attendee-skill.md`.
- Added JWT-based agent registration/auth flow with scoped permissions and legacy compatibility gate.
- Added subscription APIs, meetup publish/confirm/withdraw APIs.
- Added push delivery stack: SSE stream, backlog replay, delivery acknowledgement.
- Added city calendar APIs, UI page, and ICS export.
- Added trust-tiered fan-out throttling and in-memory delivery/event stores for v1 prototype behavior.
- Revised host/attendee skill documents with explicit learn-first event-delegator workflow.
- Revised host page and README workflow to match: human request -> skill read -> event publish -> distribution -> confirmation -> invitation letter.
- Added attendee human confirmation flow with personalized invite links (`/invite/:inviteId`).
- Added invitation letter flow with fun passcode generation, hash-only storage, and verification endpoint (`/letter/:token/verify`).
- Added passcode attempt controls (hourly limit + lock/reconfirm conditions) and private detail reveal (exact location/time/attendee list).
